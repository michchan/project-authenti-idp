<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create New Password - AuthentiIDP</title>
    <link rel="stylesheet" href="styles.css">
    <script src="theme-manager.js"></script>
</head>
<body>
    <div class="auth-container">
        <div class="auth-card">
            <!-- Header -->
            <div class="text-center" style="margin-bottom: 32px;">
                <h1 style="color: var(--color-primary); margin-bottom: 8px;">üîê AuthentiIDP</h1>
                <p class="text-muted">Create New Password</p>
            </div>

            <!-- Success Alert (hidden by default) -->
            <div class="alert alert-success" style="display: none;" id="success-alert">
                <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
                <div>
                    <strong>Password updated!</strong> You can now sign in with your new password.
                </div>
            </div>

            <!-- Error Alert (hidden by default) -->
            <div class="alert alert-error" style="display: none;" id="error-alert">
                <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m9-.75a9 9 0 11-18 0 9 9 0 0118 0zm-9 3.75h.008v.008H12v-.008z" />
                </svg>
                <div>
                    <strong>Error:</strong> <span id="error-message">Passwords do not match.</span>
                </div>
            </div>

            <!-- Main Content -->
            <div style="margin-bottom: 32px;">
                <div style="width: 64px; height: 64px; background: var(--color-secondary); border-radius: var(--radius-full); margin: 0 auto 24px; display: flex; align-items: center; justify-content: center; font-size: 24px;">
                    üîë
                </div>
                <h2 style="font-size: var(--font-size-xl); margin-bottom: 16px; text-align: center;">Reset Password</h2>
                <p style="color: var(--color-text-muted); text-align: center; margin-bottom: 24px;">
                    Create a new password for your account:
                </p>
            </div>

            <!-- New Password Form -->
            <form id="new-password-form">
                <div class="form-group">
                    <label for="new-password" class="form-label">New Password</label>
                    <input 
                        type="password" 
                        id="new-password" 
                        name="password" 
                        class="form-input" 
                        placeholder="Enter your new password"
                        required
                        autocomplete="new-password"
                    >
                    <!-- Password Strength Indicator -->
                    <div style="margin-top: 8px; display: none;" id="strength-indicator">
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <div style="flex: 1; height: 4px; background: var(--color-border); border-radius: 2px; overflow: hidden;">
                                <div id="strength-bar" style="height: 100%; width: 0%; background: var(--color-error); transition: all 0.3s;"></div>
                            </div>
                            <span id="strength-text" class="text-sm text-muted">Weak</span>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label for="confirm-password" class="form-label">Confirm New Password</label>
                    <input 
                        type="password" 
                        id="confirm-password" 
                        name="confirmPassword" 
                        class="form-input" 
                        placeholder="Confirm your new password"
                        required
                        autocomplete="new-password"
                    >
                </div>

                <!-- Password Requirements -->
                <div style="background: var(--color-secondary); padding: 16px; border-radius: var(--radius-md); margin-bottom: 24px;">
                    <h4 style="font-size: var(--font-size-sm); font-weight: 600; margin-bottom: 8px;">Password Requirements:</h4>
                    <ul id="password-requirements" style="font-size: var(--font-size-sm); color: var(--color-text-muted); margin: 0; padding-left: 20px;">
                        <li id="req-length" style="margin-bottom: 4px;">At least 8 characters</li>
                        <li id="req-uppercase" style="margin-bottom: 4px;">One uppercase letter</li>
                        <li id="req-lowercase" style="margin-bottom: 4px;">One lowercase letter</li>
                        <li id="req-number" style="margin-bottom: 4px;">One number or symbol</li>
                    </ul>
                </div>

                <!-- Security Option -->
                <div class="form-group">
                    <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                        <input type="checkbox" name="signOutOther" id="sign-out-other" checked>
                        <span class="text-sm">Sign out all other devices</span>
                    </label>
                    <p class="form-help">For added security, this will sign you out of all other devices where you're logged in.</p>
                </div>

                <button type="submit" class="btn btn-primary btn-full" id="update-btn">
                    <span id="update-text">Update Password</span>
                    <svg id="update-spinner" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" style="display: none; animation: spin 1s linear infinite;">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z" />
                    </svg>
                </button>
            </form>
        </div>

        <!-- Theme Toggle -->
        <button class="theme-toggle" id="theme-toggle" style="position: fixed; top: 24px; right: 24px;" aria-label="Toggle theme">
            üåô
        </button>
    </div>

    <script>
        // Theme management is now handled by the shared theme-manager.js
            

        // Password Strength Checker
        class PasswordChecker {
            constructor() {
                this.passwordInput = document.getElementById('new-password');
                this.strengthIndicator = document.getElementById('strength-indicator');
                this.strengthBar = document.getElementById('strength-bar');
                this.strengthText = document.getElementById('strength-text');
                this.requirements = {
                    length: document.getElementById('req-length'),
                    uppercase: document.getElementById('req-uppercase'),
                    lowercase: document.getElementById('req-lowercase'),
                    number: document.getElementById('req-number')
                };
                
                this.init();
            }
            
            init() {
                this.passwordInput.addEventListener('input', () => {
                    this.checkPassword(this.passwordInput.value);
                });
            }
            
            checkPassword(password) {
                if (password.length === 0) {
                    this.strengthIndicator.style.display = 'none';
                    this.resetRequirements();
                    return;
                }
                
                this.strengthIndicator.style.display = 'block';
                
                const checks = {
                    length: password.length >= 8,
                    uppercase: /[A-Z]/.test(password),
                    lowercase: /[a-z]/.test(password),
                    number: /[\d\W]/.test(password)
                };
                
                const score = Object.values(checks).filter(Boolean).length;
                
                // Update requirements
                Object.keys(checks).forEach(req => {
                    if (checks[req]) {
                        this.requirements[req].style.color = 'var(--color-success)';
                        this.requirements[req].innerHTML = '‚úì ' + this.requirements[req].textContent.replace('‚úì ', '');
                    } else {
                        this.requirements[req].style.color = 'var(--color-text-muted)';
                        this.requirements[req].innerHTML = this.requirements[req].textContent.replace('‚úì ', '');
                    }
                });
                
                // Update strength bar
                const percentage = (score / 4) * 100;
                this.strengthBar.style.width = percentage + '%';
                
                if (score < 2) {
                    this.strengthBar.style.background = 'var(--color-error)';
                    this.strengthText.textContent = 'Weak';
                } else if (score < 3) {
                    this.strengthBar.style.background = 'var(--color-warning)';
                    this.strengthText.textContent = 'Fair';
                } else if (score < 4) {
                    this.strengthBar.style.background = '#3b82f6';
                    this.strengthText.textContent = 'Good';
                } else {
                    this.strengthBar.style.background = 'var(--color-success)';
                    this.strengthText.textContent = 'Strong';
                }
            }
            
            resetRequirements() {
                Object.values(this.requirements).forEach(req => {
                    req.style.color = 'var(--color-text-muted)';
                    req.innerHTML = req.textContent.replace('‚úì ', '');
                });
            }
        }

        // Form Handling
        document.getElementById('new-password-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const btn = document.getElementById('update-btn');
            const text = document.getElementById('update-text');
            const spinner = document.getElementById('update-spinner');
            const errorAlert = document.getElementById('error-alert');
            const errorMessage = document.getElementById('error-message');
            const successAlert = document.getElementById('success-alert');
            
            // Hide alerts
            errorAlert.style.display = 'none';
            successAlert.style.display = 'none';
            
            const password = document.getElementById('new-password').value;
            const confirmPassword = document.getElementById('confirm-password').value;
            
            // Validation
            if (password !== confirmPassword) {
                errorMessage.textContent = 'Passwords do not match.';
                errorAlert.style.display = 'flex';
                return;
            }
            
            if (password.length < 8) {
                errorMessage.textContent = 'Password must be at least 8 characters long.';
                errorAlert.style.display = 'flex';
                return;
            }
            
            // Show loading state
            btn.disabled = true;
            text.textContent = 'Updating...';
            spinner.style.display = 'block';
            
            // Simulate API call
            setTimeout(() => {
                // Success
                successAlert.style.display = 'flex';
                
                // Redirect after delay
                setTimeout(() => {
                    window.location.href = '01-login.html';
                }, 2000);
            }, 2000);
        });

        // Initialize components (theme manager is automatically initialized by theme-manager.js)
        new PasswordChecker();
    </script>
</body>
</html>